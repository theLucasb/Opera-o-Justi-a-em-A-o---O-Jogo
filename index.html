<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Opera√ß√£o Justi√ßa em A√ß√£o - O Jogo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Inter:wght@400;700&display=swap"
        rel="stylesheet" />
    <style>
        body {
            font-family: "Inter", sans-serif;
            background-color: #1a202c;
        }

        .font-roboto-mono {
            font-family: "Roboto Mono", monospace;
        }

        .game-card {
            background-color: #2d3748;
            border: 1px solid #4a5568;
        }

        .answer-btn {
            transition: all 0.2s ease-in-out;
        }

        .screen {
            transition: opacity 0.5s ease-in-out;
        }

        .hidden {
            display: none;
        }

        #badges-container img {
            transition: transform 0.3s ease, opacity 0.5s ease;
        }

        #badges-container img.hidden-badge {
            opacity: 0;
            transform: scale(0.5);
        }

        #video-card {
            opacity: 0;
            transition: opacity 1s ease-in;
        }

        #video-card:not(.hidden) {
            opacity: 1;
        }
    </style>
</head>

<body class="text-gray-200 flex items-center justify-center min-h-screen p-4">
    <div id="game-container" class="w-full max-w-3xl mx-auto">
        <div id="start-screen" class="screen game-card rounded-lg p-8 text-center shadow-2xl">
            <!-- STORYBOOK SCREEN -->
            <div class="text-center mb-6">
                <h1 class="text-4xl font-bold font-roboto-mono tracking-wider text-yellow-400">
                    OPERA√á√ÉO JUSTI√áA EM A√á√ÉO
                </h1>
                <p class="text-gray-400">
                    Sua miss√£o: Resolver os casos e se tornar um Mestre da Justi√ßa.
                </p>

                <p class="mb-6 text-gray-300 leading-relaxed">
                    Agente, antes de iniciar a
                    <strong>Opera√ß√£o Justi√ßa em A√ß√£o</strong>, voc√™ deve conhecer o
                    contexto da miss√£o. Leia atentamente o
                    <strong>Storybook</strong> abaixo ‚Äî ele cont√©m as informa√ß√µes que
                    orientar√£o suas decis√µes durante o jogo.
                </p>

                <button onclick="openStorybook()"
                    class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-3 px-8 rounded-lg shadow-lg mb-6">
                    üìñ ABRIR STORYBOOK DE TREINAMENTO
                </button>
                <p class="text-sm text-gray-400 mb-4 italic">
                    Ap√≥s ler o Storybook, volte aqui e inicie sua opera√ß√£o.
                </p>
            </div>
            <h2 class="text-2xl font-bold mb-4">Briefing da Miss√£o</h2>
            <p class="mb-6 text-gray-300">
                Agente, insira seu nome para iniciar a opera√ß√£o. Seu progresso ser√°
                salvo localmente.
            </p>
            <input type="text" id="agent-name" placeholder="Digite seu nome de Agente"
                class="bg-gray-800 text-center w-full max-w-xs p-2 rounded mb-6 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-400" />
            <button onclick="startGame()"
                class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-3 px-8 rounded-lg shadow-lg">
                INICIAR OPERA√á√ÉO
            </button>
        </div>
        <div id="quiz-screen" class="screen hidden w-full">
            <div class="flex justify-between items-center mb-4 font-roboto-mono text-lg">
                <div>
                    <span class="font-bold">XP: </span><span id="score" class="text-yellow-400 font-bold">0</span>
                </div>
                <div><span id="rank" class="font-bold text-cyan-400"></span></div>
            </div>
            <div id="progress-bar-container" class="w-full bg-gray-700 rounded-full h-2.5 mb-4">
                <div id="progress-bar" class="bg-yellow-400 h-2.5 rounded-full"
                    style="width: 0%; transition: width 0.5s ease-out"></div>
            </div>
            <div class="game-card rounded-lg p-6 md:p-8 shadow-2xl">
                <div class="mb-4 text-sm font-roboto-mono">
                    <span>CASO N¬∫ <span id="question-number">1</span> DE 10</span>
                </div>
                <h2 id="question" class="text-xl md:text-2xl font-bold mb-6 min-h-[100px]"></h2>
                <div id="answer-buttons" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                <div id="help-container" class="mt-6 text-center flex justify-center items-center gap-6">
                    <button id="hint-button" onclick="showHint()" class="text-sm text-cyan-400 hover:text-cyan-300">
                        Precisa de uma pista, Agente?
                    </button>
                    <a href="https://gemini.google.com/u/1/gem/40be5599dc62" target="_blank"
                        class="text-sm text-yellow-400 hover:text-yellow-300">Consultar Tutor SENAI</a>
                </div>
            </div>
        </div>
        <div id="feedback-screen" class="screen hidden w-full">
            <div class="game-card rounded-lg p-6 md:p-8 shadow-2xl">
                <h2 id="feedback-title" class="text-2xl font-bold mb-6 text-center">
                    An√°lise do Caso
                </h2>
                <div id="rationales-container" class="space-y-4 mb-6"></div>
                <div class="text-center">
                    <button onclick="nextQuestion()"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg">
                        PR√ìXIMO CASO
                    </button>
                </div>
            </div>
        </div>
        <div id="end-screen" class="screen hidden game-card rounded-lg p-8 text-center shadow-2xl">
            <h2 class="text-3xl font-bold text-yellow-400 mb-4">
                MISS√ÉO CONCLU√çDA!
            </h2>
            <p class="text-lg mb-2">
                Seu resultado final, Agente
                <span id="final-agent-name" class="font-bold"></span>:
            </p>
            <p class="text-5xl font-bold mb-4"><span id="final-score"></span> XP</p>
            <p class="text-2xl font-bold mb-6">
                Promo√ß√£o para: <span id="final-rank" class="text-cyan-400"></span>
            </p>
            <p class="mb-6 text-gray-300" id="end-message"></p>
            <div id="badges-container" class="mt-6 flex justify-center items-center gap-4">
                <img id="badge-1" src="badges/Lucid_Origin_vector_art_badge_icon_Defender_of_Human_Rights_aw_2.jpg"
                    class="h-20 w-20 hidden-badge" title="Defensor dos Direitos Humanos" />
                <img id="badge-2" src="badges/Lucid_Origin_Vector_art_badge_icon_of_the_Equality_Protector_a_1.jpg"
                    class="h-20 w-20 hidden-badge" title="Protetor da Igualdade" />
                <img id="badge-3" src="badges/Lucid_Origin_vector_art_badge_icon_Labor_Law_Specialist_award__2.jpg"
                    class="h-20 w-20 hidden-badge" title="Especialista Trabalhista" />
                <img id="badge-4" src="badges/Lucid_Origin_vector_art_badge_icon_Digital_Sentinel_award_Styl_2.jpg"
                    class="h-20 w-20 hidden-badge" title="Sentinela Digital" />
            </div>
            <div id="study-guide-container"
                class="hidden mt-6 text-left p-4 bg-gray-800 rounded-lg border border-gray-700">
                <h3 class="font-bold text-lg mb-2 text-yellow-400">
                    Plano de A√ß√£o Sugerido:
                </h3>
                <p id="study-guide-text" class="text-gray-300 mb-4"></p>
                <a id="tutor-link-personalized" href="#" target="_blank"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Iniciar Sess√£o de
                    Estudo com Tutor</a>
            </div>
            <!-- CARD DO V√çDEO FINAL -->
            <div id="video-card" class="mt-8 hidden">
                <h3 class="text-2xl font-bold text-yellow-400 mb-4">
                    üé¨ Miss√£o Especial de Encerramento
                </h3>
                <p class="text-gray-300 mb-4">
                    Assista ao v√≠deo abaixo para concluir oficialmente sua jornada como
                    Agente da Justi√ßa.
                </p>
                <div class="rounded-lg overflow-hidden shadow-lg border border-gray-700">
                    <iframe id="final-video" class="w-full aspect-video" src="https://www.youtube.com/embed/dGE-5q6LOHc"
                        title="Opera√ß√£o Justi√ßa em A√ß√£o - Encerramento"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                    </iframe>
                </div>
            </div>

            <button onclick="restartGame()"
                class="mt-6 bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-3 px-8 rounded-lg shadow-lg">
                JOGAR NOVAMENTE
            </button>
        </div>
    </div>

    <script>
        const quizData = [
            {
                question:
                    "No cen√°rio do 'Caso da Inclus√£o Negada', um colega √© alvo constante de piadas ofensivas por causa de sua etnia. Qual legisla√ß√£o brasileira √© a principal ferramenta para combater essa pr√°tica?",
                topic: "Direito e Cidadania",
                hint: "Pense na legisla√ß√£o criada especificamente para proteger contra a discrimina√ß√£o baseada na cor da pele ou etnia.",
                answerOptions: [
                    {
                        text: "Estatuto da Igualdade Racial (Lei 12.288/2010)",
                        isCorrect: true,
                        rationale:
                            "Esta lei √© espec√≠fica para combater a discrimina√ß√£o √©tnica e promover a igualdade de oportunidades.",
                    },
                    {
                        text: "Declara√ß√£o Universal dos Direitos Humanos",
                        isCorrect: false,
                        rationale:
                            "A DUDH condena a discrimina√ß√£o, mas o Estatuto √© uma lei federal brasileira com aplica√ß√£o direta.",
                    },
                    {
                        text: "Lei da Aprendizagem",
                        isCorrect: false,
                        rationale:
                            "Esta lei trata das regras do contrato do jovem aprendiz, n√£o de discrimina√ß√£o racial.",
                    },
                    {
                        text: "C√≥digo de Defesa do Consumidor",
                        isCorrect: false,
                        rationale:
                            "Este c√≥digo regula as rela√ß√µes de consumo e n√£o se aplica a rela√ß√µes interpessoais no trabalho.",
                    },
                ],
            },
            {
                question:
                    "Na 'Miss√£o Receita Oculta', um empres√°rio vende produtos sem emitir nota fiscal para 'economizar' nos impostos. Como essa pr√°tica √© legalmente chamada?",
                topic: "Direito Tribut√°rio",
                hint: "A palavra-chave √© a inten√ß√£o de 'esconder' a receita do governo.",
                answerOptions: [
                    {
                        text: "Planejamento tribut√°rio",
                        isCorrect: false,
                        rationale:
                            "Planejamento tribut√°rio envolve m√©todos legais para reduzir impostos, o que √© diferente de n√£o pag√°-los.",
                    },
                    {
                        text: "Sonega√ß√£o fiscal",
                        isCorrect: true,
                        rationale:
                            "Sonegar significa ocultar informa√ß√µes das autoridades fiscais para n√£o pagar impostos, o que √© crime.",
                    },
                    {
                        text: "Elus√£o fiscal",
                        isCorrect: false,
                        rationale:
                            "Elus√£o fiscal √© buscar brechas na lei para diminuir impostos; a n√£o emiss√£o de nota √© claramente ilegal.",
                    },
                    {
                        text: "Contrabando",
                        isCorrect: false,
                        rationale:
                            "Contrabando √© a importa√ß√£o/exporta√ß√£o de produtos proibidos ou sem pagamento de taxas, diferente da venda interna sem nota.",
                    },
                ],
            },
            {
                question:
                    "Na 'Opera√ß√£o Contrato Fantasma', qual √© a jornada de trabalho m√°xima permitida para um jovem aprendiz que ainda n√£o concluiu o ensino fundamental?",
                topic: "Direito do Trabalho",
                hint: "A legisla√ß√£o do aprendiz prioriza o tempo dedicado √† educa√ß√£o formal.",
                answerOptions: [
                    {
                        text: "6 horas di√°rias",
                        isCorrect: true,
                        rationale:
                            "A lei limita a jornada a 6 horas para aprendizes que n√£o completaram o ensino fundamental, para n√£o prejudicar os estudos.",
                    },
                    {
                        text: "8 horas di√°rias",
                        isCorrect: false,
                        rationale:
                            "A jornada de 8 horas s√≥ √© permitida para aprendizes que j√° conclu√≠ram o ensino fundamental.",
                    },
                    {
                        text: "4 horas di√°rias",
                        isCorrect: false,
                        rationale:
                            "Embora existam contratos com essa carga, o limite m√°ximo legal √© de 6 horas para quem est√° no ensino fundamental.",
                    },
                    {
                        text: "7 horas di√°rias",
                        isCorrect: false,
                        rationale:
                            "Qualquer jornada acima de 6 horas para um aprendiz que n√£o concluiu o ensino fundamental est√° em desacordo com a lei.",
                    },
                ],
            },
            {
                question:
                    "Qual o princ√≠pio fundamental da Declara√ß√£o Universal dos Direitos Humanos (DUDH) que serve de base para todos os outros direitos?",
                topic: "Direitos Humanos e Cidadania",
                hint: "Pense no valor essencial que todas as pessoas possuem, simplesmente por existirem.",
                answerOptions: [
                    {
                        text: "A dignidade √© inerente a todos os seres humanos e √© o fundamento da liberdade e da justi√ßa.",
                        isCorrect: true,
                        rationale:
                            "Este √© o conceito central; todos os direitos derivam do reconhecimento do valor intr√≠nseco de cada pessoa.",
                    },
                    {
                        text: "A propriedade privada √© o direito mais importante de todos.",
                        isCorrect: false,
                        rationale:
                            "A propriedade √© um direito previsto, mas o princ√≠pio basilar da DUDH √© mais amplo e focado na condi√ß√£o humana.",
                    },
                    {
                        text: "Apenas cidad√£os de pa√≠ses desenvolvidos possuem todos os direitos.",
                        isCorrect: false,
                        rationale:
                            "O nome 'Universal' indica que os direitos se aplicam a todas as pessoas, em todos os lugares.",
                    },
                    {
                        text: "A liberdade de express√£o n√£o possui quaisquer limites.",
                        isCorrect: false,
                        rationale:
                            "A liberdade de express√£o √© um direito fundamental, mas pode ser limitada para respeitar os direitos de outros.",
                    },
                ],
            },
            {
                question:
                    "Um jovem compra um fone pela internet, mas ele chega com defeito. Segundo o C√≥digo de Defesa do Consumidor, o que ele pode exigir?",
                topic: "Direito do Consumidor",
                hint: "A lei oferece ao consumidor um poder de escolha para solucionar o problema de um produto com defeito.",
                answerOptions: [
                    {
                        text: "Apenas um cupom de desconto para a pr√≥xima compra.",
                        isCorrect: false,
                        rationale:
                            "Um desconto n√£o resolve o problema do produto defeituoso e n√£o √© uma das op√ß√µes garantidas por lei.",
                    },
                    {
                        text: "A substitui√ß√£o do produto, o conserto em at√© 30 dias ou o dinheiro de volta.",
                        isCorrect: true,
                        rationale:
                            "O c√≥digo garante ao consumidor a escolha entre essas tr√™s op√ß√µes caso o v√≠cio do produto n√£o seja sanado no prazo legal.",
                    },
                    {
                        text: "Apenas o envio do produto para o conserto.",
                        isCorrect: false,
                        rationale:
                            "O conserto √© uma op√ß√£o, mas a lei d√° ao consumidor o direito de escolher tamb√©m a troca ou a devolu√ß√£o do dinheiro.",
                    },
                    {
                        text: "Apenas a troca por um produto de valor igual ou inferior.",
                        isCorrect: false,
                        rationale:
                            "A troca √© um direito, mas o consumidor tamb√©m tem a op√ß√£o de receber seu dinheiro de volta.",
                    },
                ],
            },
            {
                question:
                    "Um funcion√°rio tira um 'print' de uma conversa particular e a espalha no grupo da empresa. Essa atitude viola algum princ√≠pio do Direito Digital?",
                topic: "Direito Digital",
                hint: "Direitos fundamentais como a privacidade tamb√©m s√£o v√°lidos no ambiente online.",
                answerOptions: [
                    {
                        text: "Sim, pois fere o direito √† privacidade e √† intimidade da pessoa exposta.",
                        isCorrect: true,
                        rationale:
                            "A prote√ß√£o √† privacidade √© um direito constitucional que se estende √†s comunica√ß√µes digitais.",
                    },
                    {
                        text: "N√£o, pois o que √© compartilhado em aplicativos de mensagem √© considerado p√∫blico.",
                        isCorrect: false,
                        rationale:
                            "Conversas privadas, mesmo em meio digital, s√£o protegidas pelo sigilo das comunica√ß√µes.",
                    },
                    {
                        text: "Sim, mas apenas se a conversa divulgada contiver informa√ß√µes falsas.",
                        isCorrect: false,
                        rationale:
                            "A viola√ß√£o da privacidade ocorre pela simples exposi√ß√£o n√£o autorizada, independentemente do conte√∫do.",
                    },
                    {
                        text: "N√£o, desde que a pessoa que tirou o 'print' n√£o tenha obtido lucro com isso.",
                        isCorrect: false,
                        rationale:
                            "O dano aqui √© moral (viola√ß√£o da privacidade) e n√£o depende de preju√≠zo financeiro.",
                    },
                ],
            },
            {
                question:
                    "Um gerente exp√µe um funcion√°rio a situa√ß√µes humilhantes de forma repetitiva na frente dos colegas. Como o Direito do Trabalho classifica essa conduta?",
                topic: "Direito do Trabalho",
                hint: "A chave para definir essa conduta √© a repeti√ß√£o de atos que visam minar a integridade psicol√≥gica do trabalhador.",
                answerOptions: [
                    {
                        text: "Ass√©dio moral",
                        isCorrect: true,
                        rationale:
                            "Caracteriza-se pela exposi√ß√£o repetitiva a situa√ß√µes vexat√≥rias que visam degradar o ambiente de trabalho.",
                    },
                    {
                        text: "Ass√©dio sexual",
                        isCorrect: false,
                        rationale:
                            "O ass√©dio sexual envolve constrangimento com conota√ß√£o sexual, o que √© diferente do cen√°rio.",
                    },
                    {
                        text: "Bullying",
                        isCorrect: false,
                        rationale:
                            "Embora semelhante, 'ass√©dio moral' √© o termo jur√≠dico para essa pr√°tica nas rela√ß√µes de trabalho.",
                    },
                    {
                        text: "Chamada de aten√ß√£o disciplinar",
                        isCorrect: false,
                        rationale:
                            "Uma chamada de aten√ß√£o deve ser reservada e respeitosa, n√£o p√∫blica e humilhante.",
                    },
                ],
            },
            {
                question:
                    "Qual o prop√≥sito principal da contribui√ß√£o mensal ao INSS descontada do sal√°rio do trabalhador?",
                topic: "Direito Previdenci√°rio",
                hint: "Pense nisso como um 'seguro' que protege o trabalhador quando ele n√£o pode mais exercer sua atividade.",
                answerOptions: [
                    {
                        text: "Garantir ao trabalhador benef√≠cios como aposentadoria, aux√≠lio-doen√ßa e pens√£o.",
                        isCorrect: true,
                        rationale:
                            "Essa contribui√ß√£o funciona como um seguro social que ampara o trabalhador em momentos de incapacidade ou idade avan√ßada.",
                    },
                    {
                        text: "Financiar o Sistema √önico de Sa√∫de (SUS).",
                        isCorrect: false,
                        rationale:
                            "A contribui√ß√£o ao INSS √© direcionada especificamente para os benef√≠cios dos trabalhadores e seus dependentes.",
                    },
                    {
                        text: "Pagar o Imposto de Renda.",
                        isCorrect: false,
                        rationale:
                            "O Imposto de Renda √© um tributo diferente, com outra finalidade.",
                    },
                    {
                        text: "Custear o seguro-desemprego.",
                        isCorrect: false,
                        rationale:
                            "O seguro-desemprego √© financiado por outro fundo (FAT).",
                    },
                ],
            },
            {
                question:
                    "Qual a diferen√ßa essencial entre um contrato de est√°gio e um contrato de trabalho formal (CLT)?",
                topic: "Direito do Trabalho",
                hint: "A natureza do contrato de est√°gio est√° diretamente ligada √† institui√ß√£o de ensino do estudante.",
                answerOptions: [
                    {
                        text: "O est√°gio n√£o gera v√≠nculo de emprego e seu objetivo principal √© o aprendizado.",
                        isCorrect: true,
                        rationale:
                            "A lei define o est√°gio como um ato educativo escolar supervisionado, n√£o uma rela√ß√£o de trabalho tradicional.",
                    },
                    {
                        text: "Apenas o trabalhador CLT tem direito a f√©rias.",
                        isCorrect: false,
                        rationale:
                            "O estagi√°rio tamb√©m tem direito a um recesso remunerado de 30 dias ap√≥s 12 meses.",
                    },
                    {
                        text: "O estagi√°rio n√£o precisa cumprir uma carga hor√°ria definida.",
                        isCorrect: false,
                        rationale:
                            "O est√°gio deve prever carga hor√°ria clara, compat√≠vel com as atividades escolares e limitada por lei.",
                    },
                    {
                        text: "Apenas o est√°gio exige um supervisor.",
                        isCorrect: false,
                        rationale:
                            "Todo trabalhador tamb√©m responde a um gestor, mas o supervisor de est√°gio tem um papel pedag√≥gico obrigat√≥rio.",
                    },
                ],
            },
            {
                question:
                    "Um jovem aprendiz sofre piadas e √© exclu√≠do pelos colegas de forma sistem√°tica. Essa situa√ß√£o se enquadra melhor em qual conceito?",
                topic: "Direito e Cidadania",
                hint: "Pense no termo usado para descrever atos de viol√™ncia intencionais e repetidos, praticados por um ou mais agressores.",
                answerOptions: [
                    {
                        text: "Conflito interpessoal",
                        isCorrect: false,
                        rationale:
                            "Um conflito √© uma diverg√™ncia pontual, enquanto a situa√ß√£o descrita envolve persegui√ß√£o cont√≠nua.",
                    },
                    {
                        text: "Crise de adapta√ß√£o",
                        isCorrect: false,
                        rationale:
                            "Dificuldades de adapta√ß√£o n√£o justificam atos de agress√£o e exclus√£o por parte dos colegas.",
                    },
                    {
                        text: "Bullying no trabalho",
                        isCorrect: true,
                        rationale:
                            "O bullying √© caracterizado por atos negativos e repetitivos, praticados contra uma pessoa, minando sua dignidade.",
                    },
                    {
                        text: "Competitividade excessiva",
                        isCorrect: false,
                        rationale:
                            "A competi√ß√£o saud√°vel n√£o envolve a humilha√ß√£o ou o isolamento de colegas.",
                    },
                ],
            },
        ];
        const screens = {
            start: document.getElementById("start-screen"),
            quiz: document.getElementById("quiz-screen"),
            feedback: document.getElementById("feedback-screen"),
            end: document.getElementById("end-screen"),
        };
        let currentQuestionIndex,
            score,
            shuffledQuestions,
            agentData = {};

        function showScreen(screenName) {
            Object.values(screens).forEach((screen) =>
                screen.classList.add("hidden")
            );
            screens[screenName].classList.remove("hidden");
        }
        function startGame() {
            const agentNameInput = document.getElementById("agent-name");
            const name = agentNameInput.value.trim();
            if (name === "") {
                alert(
                    "Por favor, insira seu nome de Agente para iniciar a opera√ß√£o."
                );
                return;
            }
            if (loadProgress() && agentData.name === name) {
                score = agentData.score;
                currentQuestionIndex = agentData.currentQuestionIndex;
            } else {
                agentData = {
                    name: name,
                    score: 0,
                    currentQuestionIndex: 0,
                    difficulties: {},
                };
                score = 0;
                currentQuestionIndex = 0;
            }
            shuffledQuestions = [...quizData].sort(() => Math.random() - 0.5);
            showScreen("quiz");
            showQuestion();
        }
        function restartGame() {
            agentData = {
                name: agentData.name,
                score: 0,
                currentQuestionIndex: 0,
                difficulties: {},
            };
            score = 0;
            currentQuestionIndex = 0;
            saveProgress();
            startGame();
        }
        function showQuestion() {
            const questionEl = document.getElementById("question"),
                answerButtonsEl = document.getElementById("answer-buttons");
            answerButtonsEl.innerHTML = "";
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            questionEl.innerText = currentQuestion.question;
            document.getElementById("question-number").innerText =
                currentQuestionIndex + 1;
            document.getElementById("hint-button").onclick = showHint;
            document.getElementById("hint-button").innerText =
                "Precisa de uma pista, Agente?";
            updateProgressBar();
            updateScoreAndRank();
            currentQuestion.answerOptions.forEach((answer) => {
                const button = document.createElement("button");
                button.innerText = answer.text;
                button.className =
                    "answer-btn w-full p-4 rounded-lg bg-gray-700 border border-gray-600 hover:bg-gray-600 text-left";
                button.onclick = () => selectAnswer(answer);
                answerButtonsEl.appendChild(button);
            });
        }
        function selectAnswer(answer) {
            const correct = answer.isCorrect;
            const currentTopic = shuffledQuestions[currentQuestionIndex].topic;
            if (correct) {
                score += 15;
                document.getElementById("feedback-title").innerText =
                    "Prova Coletada!";
                document.getElementById("feedback-title").style.color = "#38a169";
            } else {
                score = Math.max(0, score - 5);
                document.getElementById("feedback-title").innerText =
                    "Falso Testemunho!";
                document.getElementById("feedback-title").style.color = "#e53e3e";
                if (!agentData.difficulties[currentTopic])
                    agentData.difficulties[currentTopic] = 0;
                agentData.difficulties[currentTopic]++;
            }
            saveProgress();
            updateScoreAndRank();
            showFeedback();
        }
        function showFeedback() {
            const rationalesContainerEl = document.getElementById(
                "rationales-container"
            );
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            rationalesContainerEl.innerHTML = "";
            currentQuestion.answerOptions.forEach((option) => {
                const rationaleDiv = document.createElement("div");
                rationaleDiv.className = `p-4 rounded-md ${option.isCorrect
                        ? "bg-green-900 border-l-4 border-green-500"
                        : "bg-red-900 border-l-4 border-red-500"
                    }`;
                rationaleDiv.innerHTML = `<p class="font-bold mb-1">${option.text}</p><p class="text-sm text-gray-300">${option.rationale}</p>`;
                rationalesContainerEl.appendChild(rationaleDiv);
            });
            showScreen("feedback");
        }
        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < shuffledQuestions.length) {
                saveProgress();
                showScreen("quiz");
                showQuestion();
            } else {
                endGame();
            }
        }
        function endGame() {
            updateProgressBar(true);
            showScreen("end");
            document.getElementById("final-agent-name").innerText = agentData.name;
            document.getElementById("final-score").innerText = score;
            const finalRank = getRank(score);
            document.getElementById("final-rank").innerText = finalRank;
            let message =
                "Continue treinando para aprimorar suas habilidades investigativas!";
            if (finalRank === "Mestre da Justi√ßa")
                message =
                    "Excelente trabalho! Voc√™ demonstrou um conhecimento exemplar da lei.";
            else if (finalRank === "Guardi√£o(√£) da Lei")
                message =
                    "√ìtimo desempenho! Voc√™ tem um futuro brilhante como protetor da justi√ßa.";
            document.getElementById("end-message").innerText = message;
            showBadges(finalRank);
            generateStudyGuide();
            saveDataForAdmin();
            document.getElementById('video-card').classList.remove('hidden');
            localStorage.removeItem("operacaoJusticaProgress");
        }
        function saveProgress() {
            agentData.score = score;
            agentData.currentQuestionIndex = currentQuestionIndex;
            localStorage.setItem(
                "operacaoJusticaProgress",
                JSON.stringify(agentData)
            );
        }
        function loadProgress() {
            const savedData = localStorage.getItem("operacaoJusticaProgress");
            if (savedData) {
                agentData = JSON.parse(savedData);
                return true;
            }
            return false;
        }
        function updateScoreAndRank() {
            document.getElementById("score").innerText = score;
            document.getElementById("rank").innerText = getRank(score);
        }
        function getRank(currentScore) {
            if (currentScore <= 50) return "Cadete da Justi√ßa";
            if (currentScore <= 100) return "Investigador(a) Legal";
            if (currentScore <= 150) return "Guardi√£o(√£) da Lei";
            return "Mestre da Justi√ßa";
        }
        function updateProgressBar(isEnd = false) {
            const progress = isEnd
                ? 100
                : (currentQuestionIndex / shuffledQuestions.length) * 100;
            document.getElementById("progress-bar").style.width = `${progress}%`;
        }
        function showHint() {
            const hintButton = document.getElementById("hint-button");
            hintButton.innerText = shuffledQuestions[currentQuestionIndex].hint;
            hintButton.onclick = null;
        }
        function showBadges(finalRank) {
            if (score > 50)
                document.getElementById("badge-1").classList.remove("hidden-badge");
            if (score > 80)
                document.getElementById("badge-2").classList.remove("hidden-badge");
            if (score > 110)
                document.getElementById("badge-3").classList.remove("hidden-badge");
            if (finalRank === "Mestre da Justi√ßa")
                document.getElementById("badge-4").classList.remove("hidden-badge");
        }
        function generateStudyGuide() {
            const guideContainer = document.getElementById("study-guide-container"),
                guideText = document.getElementById("study-guide-text"),
                tutorLink = document.getElementById("tutor-link-personalized");
            const sortedDifficulties = Object.entries(agentData.difficulties).sort(
                ([, a], [, b]) => b - a
            );
            if (sortedDifficulties.length > 0) {
                const topDifficulties = sortedDifficulties
                    .map((item) => item[0])
                    .join(", ");
                let prompt_para_ia = `Ol√° Tutor SENAI. Meu nome √© ${agentData.name}. Conclu√≠ a simula√ß√£o "Opera√ß√£o Justi√ßa em A√ß√£o" e meu sistema identificou que preciso de refor√ßo nos seguintes temas: ${topDifficulties}. Pode me ajudar a revisar os conceitos chave desses t√≥picos com exemplos pr√°ticos?`;
                guideText.innerHTML = `An√°lise t√°tica identificou oportunidades de melhoria nos seguintes t√≥picos: <strong>${topDifficulties}</strong>. <br><br><strong class='text-yellow-400'>Copie a mensagem abaixo e cole no seu Tutor Gemini:</strong><br><textarea readonly class='w-full h-full bg-gray-900 p-2 mt-2 rounded border border-gray-600 text-gray-300'>${prompt_para_ia}</textarea>`;
                tutorLink.href = "https://gemini.google.com/u/1/gem/40be5599dc62";
                guideContainer.classList.remove("hidden");
            } else {
                guideContainer.classList.add("hidden");
            }
        }

        function openStorybook() {
            window.open("https://gemini.google.com/share/85734affc482", "_blank");
        }

        function saveDataForAdmin() {
            const adminDataKey = "operacaoJusticaAdminData";
            let allResults = [];
            try {
                const existingData = localStorage.getItem(adminDataKey);
                if (existingData) {
                    allResults = JSON.parse(existingData);
                }
            } catch (e) {
                console.error("Dados de admin corrompidos, resetando:", e);
                allResults = [];
            }

            const difficultiesString =
                Object.keys(agentData.difficulties).join(", ") || "Nenhuma";
            const newResult = {
                timestamp: new Date().toLocaleString("pt-BR"),
                agentName: agentData.name,
                finalScore: score,
                finalRank: getRank(score),
                difficulties: difficultiesString,
            };
            allResults.push(newResult);
            localStorage.setItem(adminDataKey, JSON.stringify(allResults));
        }
    </script>
</body>

</html>